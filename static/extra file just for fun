@app.route("/payment",methods=['GET'])
@login_required
def payment():
    cart = current_user.carts.filter(Cart.status == 'pending').first()
    r = requests.post(connfig.PAYMENT_FIRST_REQUEST_URL,
                      data ={
                          'api': connfig.PAYMENT_MERCHANT,
                          'amount':cart.total_price(),
                          'callback':connfig.PAYMENT_CALLBACK

                      })

    token = r.json()['result']['token']
    url = r.json()['result']['url']
    pay = Payment(price = cart.total_price(),token = token)
    pay.cart = cart
    db.session.add(pay)
    db.session.commit()
    return redirect(url)